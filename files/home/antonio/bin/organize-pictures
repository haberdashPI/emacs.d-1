#!/bin/bash

format="%Y/%m/%d/%F-%H%M%%-c.%%e"

src=$1
dest=$2

# if possible, use the exif data
exiftool -r "-FileName<CreateDate" -d $format $src >/dev/null

# iPhoto processing
if [ -n $IPHOTO ]; then
  IFS=
  find $src -type f | while read -r picture; do
    path=$(echo $picture | rev | cut -d/ -f3-5 | rev)
    mkdir -p $dest/$path
    mv "$picture" $dest/$path
  done
fi

echo "Unprocessed files:"
find $src -type f
