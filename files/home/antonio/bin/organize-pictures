#!/bin/bash

src=$1
dest=$2

if [ -z $src -o -z $dest ]; then
  echo "Usage: organize-pictures <SRC> <DST>"
  exit 1
fi

format="%Y/%m/%d/%F-%H%M%%-c.%%e"

# if possible, use the exif data
exiftool -r "-FileName<CreateDate" -d $dest/$format $src >/dev/null

# iPhoto processing
if [ -n $IPHOTO ]; then
  IFS=
  find $src -type f | while read -r picture; do
    path=$(echo $picture | rev | cut -d/ -f3-5 | rev)
    mkdir -p $dest/$path
    mv "$picture" $dest/$path
  done
fi

fdupes -r $dest

echo "Unprocessed files:"
find $src -type f
